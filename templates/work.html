<html>
<head>
  <title>{{work_creator}} : {{work_title}} — TraduXio</title>
  <script src="script/jquery.js"></script>  
  <script type="text/javascript">

  function toggle(index) {
    $("tr").find("td:nth-child(" + index + ")").find("div").toggle();
    var button = $("tr").find("th:nth-child(" + index + ")").find("button")
    button.text(
      (button.text()=="Cacher")? "Afficher" : "Cacher"
    );
  }

  $(document).ready(function() {

    $("form").submit(function(event) { //TODO jQuery 2
      event.preventDefault();
      var q = $(this).find('#query').val().toLowerCase();
      window.location.href = 'concordance?startkey=["{{work_language}}","' + q 
        + '"]&endkey=["{{work_language}}","' + q 
        + '\\u9999"]&query=' + q ;
    });

    $(".toggle").click(function() { //TODO jQuery 2
      toggle($(this).closest("th").index() + 1);
    });

    const N = $("th").length;
    for (var i = 3; i<=N; i++) {
      toggle(i);
    }

  });

  </script>
</head>
<body>
  <form>
    <input id="query" type="search" placeholder="Rechercher" />
  </form>
  <h1>{{work_title}} – {{work_creator}}</h1>
  <table>
    <tr>
      {{#headers}}
        <th>
          {{title}}<br/>
          {{work_creator}}<br/>
          {{language}} — {{creator}} {{date}}<br/>
          {{#creativeCommons}}
            <a href="http://creativecommons.org/licenses/{{creativeCommons}}/3.0/fr">
              <img src="http://i.creativecommons.org/l/{{creativeCommons}}/3.0/88x31.png"/>
            </a>
          {{/creativeCommons}}
          {{^creativeCommons}}
            Tous droits réservés.
          {{/creativeCommons}}
          <br/>
          <button class="toggle">Cacher</button>
        </th>
      {{/headers}}
    </tr>
    {{#units}}
    <tr>
      {{#versions}}
        <td>{{{.}}}</td>
      {{/versions}}
    </tr>
    {{/units}}
  </table>
</body>
</html>
